# Gitleaks Configuration for Pathfinder
# Prevents accidental commit of secrets

title = "Pathfinder Gitleaks Config"

[allowlist]
  description = "Global allowlist"
  paths = [
    '''.archive/.*''',
    '''\.git/.*''',
    '''node_modules/.*''',
    '''\.venv/.*''',
    '''venv/.*''',
    '''__pycache__/.*''',
    '''\.pytest_cache/.*''',
    # Test files with mock credentials
    '''.*test.*\.py$''',
    '''.*\.test\.ts$''',
    '''.*\.spec\.ts$''',
    '''conftest\.py$''',
  ]

# Extend default rules
[extend]
  useDefault = true

# Custom rules for Azure/OpenAI specific patterns
[[rules]]
  id = "azure-cosmos-key"
  description = "Azure Cosmos DB Key"
  regex = '''(?i)(cosmos[_-]?db[_-]?key|COSMOS_DB_KEY)\s*[=:]\s*['"]*[A-Za-z0-9+/=]{40,}['"]*'''
  keywords = ["cosmos"]

[[rules]]
  id = "azure-signalr-connection"
  description = "Azure SignalR Connection String"
  regex = '''Endpoint=https://.*\.service\.signalr\.net;AccessKey=[A-Za-z0-9+/=]+'''
  keywords = ["signalr", "endpoint"]

[[rules]]
  id = "openai-api-key"
  description = "OpenAI API Key"
  regex = '''sk-[A-Za-z0-9]{32,}'''
  keywords = ["openai", "sk-"]

[[rules]]
  id = "azure-storage-key"
  description = "Azure Storage Account Key"
  regex = '''(?i)(storage[_-]?account[_-]?key|AZURE_STORAGE_KEY)\s*[=:]\s*['"]*[A-Za-z0-9+/=]{40,}['"]*'''
  keywords = ["storage"]

[[rules]]
  id = "entra-client-secret"
  description = "Microsoft Entra Client Secret"
  regex = '''(?i)(client[_-]?secret|ENTRA_CLIENT_SECRET)\s*[=:]\s*['"]*[A-Za-z0-9~._-]{30,}['"]*'''
  keywords = ["client_secret", "entra"]

# Allowlist specific patterns (placeholder values)
[allowlist]
  regexes = [
    '''your-.*-key''',
    '''test-key''',
    '''placeholder''',
    '''YOUR_.*''',
    '''<your-.*>''',
    '''example\.com''',
    '''localhost''',
  ]
